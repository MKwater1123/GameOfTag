  "game_session_v1": {
    "status": "active",
    "settings": {
      "center_lat": 35.6895,
      "center_lng": 139.6917,
      "radius_meter": 500
    },
    "players": {
      "user_id_A": {
        "username": "鬼の田中",  // ← 新規追加
        "role": "oni",
        "lat": 35.6890,
        "lng": 139.6910,
        "updated_at": 1700000000123
      },
      "user_id_B": {
        "username": "逃げる佐藤", // ← 新規追加
        "role": "runner",
        "lat": 35.6880,
        "lng": 139.6920,
        "updated_at": 1700000600123 // 10分前のタイムスタンプのままになる
      }
    }
  }
}
5. 画面UI構成案トップ画面:タイトルロゴ名前入力フォーム[鬼で参加] ボタン / [逃走者で参加] ボタンメインマップ画面:全面：地図（Leaflet）上部：ステータスバー（自分の役割・エリア判定状態）下部：（逃走者の場合）位置バレまでのカウントダウンタイマー（鬼の場合）「逃走者位置の更新時間」の表示
📱 **GPSリアル鬼ごっこアプリ 開発仕様書 (Ver 2.0)**

---

## 1. プロジェクト概要
- **アプリ名**: （仮）GPS Tag
- **目的**: GPSを利用したリアル鬼ごっこを、無料かつOS依存なしで実施する。
- **プラットフォーム**: Webアプリケーション（HTML5 + Firebase）

---

## 2. ユーザーロール（役割）定義
アプリ起動時に名前入力と役割選択を行う。

| ロール名称 | 特徴 | 地図で見えるもの |
|:---:|:---|:---|
| **鬼 (Oni)** | 全員の位置を把握できる | 自分 ＋ 他の鬼 ＋ 逃走者 |
| **逃走者 (Runner)** | 鬼の位置は見えない。位置送信に制限あり | 自分 ＋ 他の逃走者（鬼は見えない） |

---

## 3. 機能要件

### 3.1. 開始・ログイン画面（新規）
- **ユーザーネーム入力**: テキストボックスで「名前（例：タナカ）」を入力。
  - 入力名は地図上ピンの上に常時ラベル表示。
- **役割選択**: 「鬼」または「逃走者」を選択してゲーム開始。

### 3.2. 地図表示・エリア制限（ジオフェンス）
- **自分自身の表示**: 役割に関係なく現在地をリアルタイム表示（例：青い矢印）。
- **エリア警告**: 設定した中心点＋半径外へ出たら、画面上に赤帯で `警告：エリア外です！` を表示しバイブレーション。

### 3.3. 位置情報共有ロジック（重要）

#### A. 鬼 (Oni) の仕様
- **送信**: 自位置（緯度・経度）を常時リアルタイム送信。
- **受信**: 全プレイヤー位置を取得し地図へ表示。
  - 逃走者は最後更新地点（最大10分前）を表示。

#### B. 逃走者 (Runner) の仕様
- **送信（10分ルール）**: 10分に1回のみ現在地を送信。それ以外は更新しない。
  - 画面にカウントダウン例：`次の位置送信まであと 09:59` を表示。
- **受信（視界制限）**: 取得時に `role == oni` のデータを除外。自分＋他逃走者のみ表示。

---

## 4. データ構造（Firebase Realtime Database）
追加フィールド: `username`

```json
{
  "game_session_v1": {
    "status": "active",
    "settings": {
      "center_lat": 35.6895,
      "center_lng": 139.6917,
      "radius_meter": 500
    },
    "players": {
      "user_id_A": {
        "username": "鬼の田中",  // 新規追加
        "role": "oni",
        "lat": 35.6890,
        "lng": 139.6910,
        "updated_at": 1700000000123
      },
      "user_id_B": {
        "username": "逃げる佐藤", // 新規追加
        "role": "runner",
        "lat": 35.6880,
        "lng": 139.6920,
        "updated_at": 1700000600123 // 10分前のタイムスタンプのまま
      }
    }
  }
}
```

---

## 5. 画面UI構成案

### トップ画面
- タイトルロゴ
- 名前入力フォーム
- 「鬼で参加」ボタン / 「逃走者で参加」ボタン

### メインマップ画面
- 全面：地図（Leaflet）
- 上部：ステータスバー（役割・エリア判定）
- 下部：
  - 逃走者：位置送信までのカウントダウンタイマー
  - 鬼：各逃走者の最終更新時刻表示

---

## 6. 今後の検討項目（任意）
- 終了条件（制限時間 / 捕捉判定）

---

最終更新日: 2025-11-22